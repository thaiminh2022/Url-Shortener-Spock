var Ve=Object.defineProperty;var ze=(i,e,t)=>e in i?Ve(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var le=(i,e,t)=>ze(i,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();function L(){}function je(i){return i()}function _e(){return Object.create(null)}function K(i){i.forEach(je)}function Le(i){return typeof i=="function"}function ae(i,e){return i!=i?e==e:i!==e||i&&typeof i=="object"||typeof i=="function"}function Qe(i){return Object.keys(i).length===0}function Ye(i,...e){if(i==null){for(const n of e)n(void 0);return L}const t=i.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Ue(i,e,t){i.$$.on_destroy.push(Ye(e,t))}function d(i,e){i.appendChild(e)}function R(i,e,t){i.insertBefore(e,t||null)}function I(i){i.parentNode&&i.parentNode.removeChild(i)}function C(i){return document.createElement(i)}function q(i){return document.createTextNode(i)}function A(){return q(" ")}function $e(){return q("")}function F(i,e,t,n){return i.addEventListener(e,t,n),()=>i.removeEventListener(e,t,n)}function xe(i){return function(e){return e.preventDefault(),i.call(this,e)}}function W(i,e,t){t==null?i.removeAttribute(e):i.getAttribute(e)!==t&&i.setAttribute(e,t)}function Xe(i){return Array.from(i.childNodes)}function Q(i,e){e=""+e,i.data!==e&&(i.data=e)}function B(i,e){i.value=e??""}function T(i,e,t,n){t==null?i.style.removeProperty(e):i.style.setProperty(e,t,"")}let ne;function te(i){ne=i}function Ne(){if(!ne)throw new Error("Function called outside component initialization");return ne}function De(i){Ne().$$.on_mount.push(i)}function Ze(i){Ne().$$.on_destroy.push(i)}function et(i,e){const t=i.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const z=[],ke=[];let Y=[];const ve=[],tt=Promise.resolve();let de=!1;function nt(){de||(de=!0,tt.then(Fe))}function fe(i){Y.push(i)}const ue=new Set;let J=0;function Fe(){if(J!==0)return;const i=ne;do{try{for(;J<z.length;){const e=z[J];J++,te(e),st(e.$$)}}catch(e){throw z.length=0,J=0,e}for(te(null),z.length=0,J=0;ke.length;)ke.pop()();for(let e=0;e<Y.length;e+=1){const t=Y[e];ue.has(t)||(ue.add(t),t())}Y.length=0}while(z.length);for(;ve.length;)ve.pop()();de=!1,ue.clear(),te(i)}function st(i){if(i.fragment!==null){i.update(),K(i.before_update);const e=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,e),i.after_update.forEach(fe)}}function it(i){const e=[],t=[];Y.forEach(n=>i.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Y=e}const re=new Set;let M;function rt(){M={r:0,c:[],p:M}}function ot(){M.r||K(M.c),M=M.p}function Z(i,e){i&&i.i&&(re.delete(i),i.i(e))}function oe(i,e,t,n){if(i&&i.o){if(re.has(i))return;re.add(i),M.c.push(()=>{re.delete(i),n&&(t&&i.d(1),n())}),i.o(e)}else n&&n()}function Pe(i){return(i==null?void 0:i.length)!==void 0?i:Array.from(i)}function at(i,e){i.d(1),e.delete(i.key)}function ct(i,e,t,n,s,r,o,c,a,l,f,u){let p=i.length,m=r.length,g=p;const k={};for(;g--;)k[i[g].key]=g;const b=[],h=new Map,S=new Map,y=[];for(g=m;g--;){const _=u(s,r,g),E=t(_);let j=o.get(E);j?y.push(()=>j.p(_,e)):(j=l(E,_),j.c()),h.set(E,b[g]=j),E in k&&S.set(E,Math.abs(g-k[E]))}const O=new Set,U=new Set;function P(_){Z(_,1),_.m(c,f),o.set(_.key,_),f=_.first,m--}for(;p&&m;){const _=b[m-1],E=i[p-1],j=_.key,w=E.key;_===E?(f=_.first,p--,m--):h.has(w)?!o.has(j)||O.has(j)?P(_):U.has(w)?p--:S.get(j)>S.get(w)?(U.add(j),P(_)):(O.add(w),p--):(a(E,o),p--)}for(;p--;){const _=i[p];h.has(_.key)||a(_,o)}for(;m;)P(b[m-1]);return K(y),b}function Ke(i){i&&i.c()}function pe(i,e,t){const{fragment:n,after_update:s}=i.$$;n&&n.m(e,t),fe(()=>{const r=i.$$.on_mount.map(je).filter(Le);i.$$.on_destroy?i.$$.on_destroy.push(...r):K(r),i.$$.on_mount=[]}),s.forEach(fe)}function me(i,e){const t=i.$$;t.fragment!==null&&(it(t.after_update),K(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function lt(i,e){i.$$.dirty[0]===-1&&(z.push(i),nt(),i.$$.dirty.fill(0)),i.$$.dirty[e/31|0]|=1<<e%31}function be(i,e,t,n,s,r,o=null,c=[-1]){const a=ne;te(i);const l=i.$$={fragment:null,ctx:[],props:r,update:L,not_equal:s,bound:_e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:_e(),dirty:c,skip_bound:!1,root:e.target||a.$$.root};o&&o(l.root);let f=!1;if(l.ctx=t?t(i,e.props||{},(u,p,...m)=>{const g=m.length?m[0]:p;return l.ctx&&s(l.ctx[u],l.ctx[u]=g)&&(!l.skip_bound&&l.bound[u]&&l.bound[u](g),f&&lt(i,u)),p}):[],l.update(),f=!0,K(l.before_update),l.fragment=n?n(l.ctx):!1,e.target){if(e.hydrate){const u=Xe(e.target);l.fragment&&l.fragment.l(u),u.forEach(I)}else l.fragment&&l.fragment.c();e.intro&&Z(i.$$.fragment),pe(i,e.target,e.anchor),Fe()}te(a)}class ge{constructor(){le(this,"$$");le(this,"$$set")}$destroy(){me(this,1),this.$destroy=L}$on(e,t){if(!Le(t))return L;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const s=n.indexOf(t);s!==-1&&n.splice(s,1)}}$set(e){this.$$set&&!Qe(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ut="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ut);class N extends Error{constructor(e){var t,n,s,r;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,N.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof N||(this.originalError=e),typeof DOMException<"u"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(r=(s=(n=this.originalError)==null?void 0:n.cause)==null?void 0:s.message)!=null&&r.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}}const ie=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function ht(i,e){const t={};if(typeof i!="string")return t;const n=Object.assign({},{}).decode||dt;let s=0;for(;s<i.length;){const r=i.indexOf("=",s);if(r===-1)break;let o=i.indexOf(";",s);if(o===-1)o=i.length;else if(o<r){s=i.lastIndexOf(";",r-1)+1;continue}const c=i.slice(s,r).trim();if(t[c]===void 0){let a=i.slice(r+1,o).trim();a.charCodeAt(0)===34&&(a=a.slice(1,-1));try{t[c]=n(a)}catch{t[c]=a}}s=o+1}return t}function Te(i,e,t){const n=Object.assign({},t||{}),s=n.encode||ft;if(!ie.test(i))throw new TypeError("argument name is invalid");const r=s(e);if(r&&!ie.test(r))throw new TypeError("argument val is invalid");let o=i+"="+r;if(n.maxAge!=null){const c=n.maxAge-0;if(isNaN(c)||!isFinite(c))throw new TypeError("option maxAge is invalid");o+="; Max-Age="+Math.floor(c)}if(n.domain){if(!ie.test(n.domain))throw new TypeError("option domain is invalid");o+="; Domain="+n.domain}if(n.path){if(!ie.test(n.path))throw new TypeError("option path is invalid");o+="; Path="+n.path}if(n.expires){if(!function(a){return Object.prototype.toString.call(a)==="[object Date]"||a instanceof Date}(n.expires)||isNaN(n.expires.valueOf()))throw new TypeError("option expires is invalid");o+="; Expires="+n.expires.toUTCString()}if(n.httpOnly&&(o+="; HttpOnly"),n.secure&&(o+="; Secure"),n.priority)switch(typeof n.priority=="string"?n.priority.toLowerCase():n.priority){case"low":o+="; Priority=Low";break;case"medium":o+="; Priority=Medium";break;case"high":o+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return o}function dt(i){return i.indexOf("%")!==-1?decodeURIComponent(i):i}function ft(i){return encodeURIComponent(i)}const pt=typeof navigator<"u"&&navigator.product==="ReactNative"||typeof global<"u"&&global.HermesInternal;let We;function X(i){if(i)try{const e=decodeURIComponent(We(i.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch{}return{}}function Be(i,e=0){let t=X(i);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}We=typeof atob!="function"||pt?i=>{let e=String(i).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,n,s=0,r=0,o="";n=e.charAt(r++);~n&&(t=s%4?64*t+n:n,s++%4)?o+=String.fromCharCode(255&t>>(-2*s&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return o}:atob;const Ee="pb_auth";class mt{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!Be(this.token)}get isAdmin(){return X(this.token).type==="admin"}get isAuthRecord(){return X(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=Ee){const n=ht(e||"")[t]||"";let s={};try{s=JSON.parse(n),(typeof s===null||typeof s!="object"||Array.isArray(s))&&(s={})}catch{}this.save(s.token||"",s.model||null)}exportToCookie(e,t=Ee){var a,l;const n={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},s=X(this.token);n.expires=s!=null&&s.exp?new Date(1e3*s.exp):new Date("1970-01-01"),e=Object.assign({},n,e);const r={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null};let o=Te(t,JSON.stringify(r),e);const c=typeof Blob<"u"?new Blob([o]).size:o.length;if(r.model&&c>4096){r.model={id:(a=r==null?void 0:r.model)==null?void 0:a.id,email:(l=r==null?void 0:r.model)==null?void 0:l.email};const f=["collectionId","username","verified"];for(const u in this.model)f.includes(u)&&(r.model[u]=this.model[u]);o=Te(t,JSON.stringify(r),e)}return o}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let n=this._onChangeCallbacks.length-1;n>=0;n--)if(this._onChangeCallbacks[n]==e)return delete this._onChangeCallbacks[n],void this._onChangeCallbacks.splice(n,1)}}triggerChange(){for(const e of this._onChangeCallbacks)e&&e(this.token,this.model)}}class bt extends mt{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window<"u"&&(window!=null&&window.localStorage)){const t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch{return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window<"u"&&(window!=null&&window.localStorage)){let n=t;typeof t!="string"&&(n=JSON.stringify(t)),window.localStorage.setItem(e,n)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window<"u"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window<"u"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;const t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}}class G{constructor(e){this.client=e}}class gt extends G{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,n){return n=Object.assign({method:"POST",body:{email:e,template:t}},n),this.client.send("/api/settings/test/email",n).then(()=>!0)}async generateAppleClientSecret(e,t,n,s,r,o){return o=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:n,privateKey:s,duration:r}},o),this.client.send("/api/settings/apple/generate-client-secret",o)}}class ye extends G{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let n=500;return(t=Object.assign({},e,t)).batch&&(n=t.batch,delete t.batch),this._getFullList(n,t)}async getList(e=1,t=30,n){return(n=Object.assign({method:"GET"},n)).query=Object.assign({page:e,perPage:t},n.query),this.client.send(this.baseCrudPath,n).then(s=>{var r;return s.items=((r=s.items)==null?void 0:r.map(o=>this.decode(o)))||[],s})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(n=>{var s;if(!((s=n==null?void 0:n.items)!=null&&s.length))throw new N({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return n.items[0]})}async getOne(e,t){if(!e)throw new N({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(n=>this.decode(n))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(n=>this.decode(n))}async update(e,t,n){return n=Object.assign({method:"PATCH",body:t},n),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),n).then(s=>this.decode(s))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let n=[],s=async r=>this.getList(r,e||500,t).then(o=>{const c=o.items;return n=n.concat(c),c.length==o.perPage?s(r+1):n});return s(1)}}function $(i,e,t,n){const s=n!==void 0;return s||t!==void 0?s?(console.warn(i),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,n),e):Object.assign(e,t):e}function he(i){var e;(e=i._resetAutoRefresh)==null||e.call(i)}class yt extends ye{get baseCrudPath(){return"/api/admins"}async update(e,t,n){return super.update(e,t,n).then(s=>{var r,o;return((r=this.client.authStore.model)==null?void 0:r.id)===s.id&&((o=this.client.authStore.model)==null?void 0:o.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,s),s})}async delete(e,t){return super.delete(e,t).then(n=>{var s,r;return n&&((s=this.client.authStore.model)==null?void 0:s.id)===e&&((r=this.client.authStore.model)==null?void 0:r.collectionId)===void 0&&this.client.authStore.clear(),n})}authResponse(e){const t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,n,s){let r={method:"POST",body:{identity:e,password:t}};r=$("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",r,n,s);const o=r.autoRefreshThreshold;delete r.autoRefreshThreshold,r.autoRefresh||he(this.client);let c=await this.client.send(this.baseCrudPath+"/auth-with-password",r);return c=this.authResponse(c),o&&function(l,f,u,p){he(l);const m=l.beforeSend,g=l.authStore.model,k=l.authStore.onChange((b,h)=>{(!b||(h==null?void 0:h.id)!=(g==null?void 0:g.id)||(h!=null&&h.collectionId||g!=null&&g.collectionId)&&(h==null?void 0:h.collectionId)!=(g==null?void 0:g.collectionId))&&he(l)});l._resetAutoRefresh=function(){k(),l.beforeSend=m,delete l._resetAutoRefresh},l.beforeSend=async(b,h)=>{var U;const S=l.authStore.token;if((U=h.query)!=null&&U.autoRefresh)return m?m(b,h):{url:b,sendOptions:h};let y=l.authStore.isValid;if(y&&Be(l.authStore.token,f))try{await u()}catch{y=!1}y||await p();const O=h.headers||{};for(let P in O)if(P.toLowerCase()=="authorization"&&S==O[P]&&l.authStore.token){O[P]=l.authStore.token;break}return h.headers=O,m?m(b,h):{url:b,sendOptions:h}}}(this.client,o,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},r))),c}async authRefresh(e,t){let n={method:"POST"};return n=$("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",n,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",n).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,n){let s={method:"POST",body:{email:e}};return s=$("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",s,t,n),this.client.send(this.baseCrudPath+"/request-password-reset",s).then(()=>!0)}async confirmPasswordReset(e,t,n,s,r){let o={method:"POST",body:{token:e,password:t,passwordConfirm:n}};return o=$("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",o,s,r),this.client.send(this.baseCrudPath+"/confirm-password-reset",o).then(()=>!0)}}const wt=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function Me(i){if(i){i.query=i.query||{};for(let e in i)wt.includes(e)||(i.query[e]=i[e],delete i[e])}}class Ge extends G{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,n){var o;if(!e)throw new Error("topic must be set.");let s=e;if(n){Me(n=Object.assign({},n));const c="options="+encodeURIComponent(JSON.stringify({query:n.query,headers:n.headers}));s+=(s.includes("?")?"&":"?")+c}const r=function(c){const a=c;let l;try{l=JSON.parse(a==null?void 0:a.data)}catch{}t(l||{})};return this.subscriptions[s]||(this.subscriptions[s]=[]),this.subscriptions[s].push(r),this.isConnected?this.subscriptions[s].length===1?await this.submitSubscriptions():(o=this.eventSource)==null||o.addEventListener(s,r):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,r)}async unsubscribe(e){var n;let t=!1;if(e){const s=this.getSubscriptionsByTopic(e);for(let r in s)if(this.hasSubscriptionListeners(r)){for(let o of this.subscriptions[r])(n=this.eventSource)==null||n.removeEventListener(r,o);delete this.subscriptions[r],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var n;let t=!1;for(let s in this.subscriptions)if((s+"?").startsWith(e)){t=!0;for(let r of this.subscriptions[s])(n=this.eventSource)==null||n.removeEventListener(s,r);delete this.subscriptions[s]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var r;let n=!1;const s=this.getSubscriptionsByTopic(e);for(let o in s){if(!Array.isArray(this.subscriptions[o])||!this.subscriptions[o].length)continue;let c=!1;for(let a=this.subscriptions[o].length-1;a>=0;a--)this.subscriptions[o][a]===t&&(c=!0,delete this.subscriptions[o][a],this.subscriptions[o].splice(a,1),(r=this.eventSource)==null||r.removeEventListener(o,t));c&&(this.subscriptions[o].length||delete this.subscriptions[o],n||this.hasSubscriptionListeners(o)||(n=!0))}this.hasSubscriptionListeners()?n&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,n;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let s in this.subscriptions)if((n=this.subscriptions[s])!=null&&n.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){const t={};e=e.includes("?")?e:e+"?";for(let n in this.subscriptions)(n+"?").startsWith(e)&&(t[n]=this.subscriptions[n]);return t}getNonEmptySubscriptionKeys(){const e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{const t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let n=3;for(;this.hasUnsentSubscriptions()&&n>0;)n--,await this.submitSubscriptions()}).then(()=>{for(let s of this.pendingConnects)s.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);const n=this.getSubscriptionsByTopic("PB_CONNECT");for(let s in n)for(let r of n[s])r(e)}).catch(n=>{this.clientId="",this.connectErrorHandler(n)})})}hasUnsentSubscriptions(){const e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(const t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let n of this.pendingConnects)n.reject(new N(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);const t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let n of this.pendingConnects)n.resolve();this.pendingConnects=[]}}}class St extends ye{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,n){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,n)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);const n=Object.assign({},e,t);return super.getFullList(n)}async getList(e=1,t=30,n){return super.getList(e,t,n)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,n){return super.update(e,t,n).then(s=>{var r,o,c;return((r=this.client.authStore.model)==null?void 0:r.id)!==(s==null?void 0:s.id)||((o=this.client.authStore.model)==null?void 0:o.collectionId)!==this.collectionIdOrName&&((c=this.client.authStore.model)==null?void 0:c.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,s),s})}async delete(e,t){return super.delete(e,t).then(n=>{var s,r,o;return!n||((s=this.client.authStore.model)==null?void 0:s.id)!==e||((r=this.client.authStore.model)==null?void 0:r.collectionId)!==this.collectionIdOrName&&((o=this.client.authStore.model)==null?void 0:o.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),n})}authResponse(e){const t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,n,s){let r={method:"POST",body:{identity:e,password:t}};return r=$("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",r,n,s),this.client.send(this.baseCollectionPath+"/auth-with-password",r).then(o=>this.authResponse(o))}async authWithOAuth2Code(e,t,n,s,r,o,c){let a={method:"POST",body:{provider:e,code:t,codeVerifier:n,redirectUrl:s,createData:r}};return a=$("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",a,o,c),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",a).then(l=>this.authResponse(l))}authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});const t=(e==null?void 0:e[0])||{};let n=null;t.urlCallback||(n=Ie(void 0));const s=new Ge(this.client);function r(){n==null||n.close(),s.unsubscribe()}const o={},c=t.requestKey;return c&&(o.requestKey=c),this.listAuthMethods(o).then(a=>{var p;const l=a.authProviders.find(m=>m.name===t.provider);if(!l)throw new N(new Error(`Missing or invalid provider "${t.provider}".`));const f=this.client.buildUrl("/api/oauth2-redirect"),u=c?(p=this.client.cancelControllers)==null?void 0:p[c]:void 0;return u&&(u.signal.onabort=()=>{r()}),new Promise(async(m,g)=>{var k;try{await s.subscribe("@oauth2",async y=>{var U;const O=s.clientId;try{if(!y.state||O!==y.state)throw new Error("State parameters don't match.");if(y.error||!y.code)throw new Error("OAuth2 redirect error or missing code: "+y.error);const P=Object.assign({},t);delete P.provider,delete P.scopes,delete P.createData,delete P.urlCallback,(U=u==null?void 0:u.signal)!=null&&U.onabort&&(u.signal.onabort=null);const _=await this.authWithOAuth2Code(l.name,y.code,l.codeVerifier,f,t.createData,P);m(_)}catch(P){g(new N(P))}r()});const b={state:s.clientId};(k=t.scopes)!=null&&k.length&&(b.scope=t.scopes.join(" "));const h=this._replaceQueryParams(l.authUrl+f,b);await(t.urlCallback||function(y){n?n.location.href=y:n=Ie(y)})(h)}catch(b){r(),g(new N(b))}})}).catch(a=>{throw r(),a})}async authRefresh(e,t){let n={method:"POST"};return n=$("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",n,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",n).then(s=>this.authResponse(s))}async requestPasswordReset(e,t,n){let s={method:"POST",body:{email:e}};return s=$("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",s,t,n),this.client.send(this.baseCollectionPath+"/request-password-reset",s).then(()=>!0)}async confirmPasswordReset(e,t,n,s,r){let o={method:"POST",body:{token:e,password:t,passwordConfirm:n}};return o=$("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",o,s,r),this.client.send(this.baseCollectionPath+"/confirm-password-reset",o).then(()=>!0)}async requestVerification(e,t,n){let s={method:"POST",body:{email:e}};return s=$("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",s,t,n),this.client.send(this.baseCollectionPath+"/request-verification",s).then(()=>!0)}async confirmVerification(e,t,n){let s={method:"POST",body:{token:e}};return s=$("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",s,t,n),this.client.send(this.baseCollectionPath+"/confirm-verification",s).then(()=>{const r=X(e),o=this.client.authStore.model;return o&&!o.verified&&o.id===r.id&&o.collectionId===r.collectionId&&(o.verified=!0,this.client.authStore.save(this.client.authStore.token,o)),!0})}async requestEmailChange(e,t,n){let s={method:"POST",body:{newEmail:e}};return s=$("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",s,t,n),this.client.send(this.baseCollectionPath+"/request-email-change",s).then(()=>!0)}async confirmEmailChange(e,t,n,s){let r={method:"POST",body:{token:e,password:t}};return r=$("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",r,n,s),this.client.send(this.baseCollectionPath+"/confirm-email-change",r).then(()=>{const o=X(e),c=this.client.authStore.model;return c&&c.id===o.id&&c.collectionId===o.collectionId&&this.client.authStore.clear(),!0})}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,n){return n=Object.assign({method:"DELETE"},n),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),n).then(()=>!0)}_replaceQueryParams(e,t={}){let n=e,s="";e.indexOf("?")>=0&&(n=e.substring(0,e.indexOf("?")),s=e.substring(e.indexOf("?")+1));const r={},o=s.split("&");for(const c of o){if(c=="")continue;const a=c.split("=");r[decodeURIComponent(a[0].replace(/\+/g," "))]=decodeURIComponent((a[1]||"").replace(/\+/g," "))}for(let c in t)t.hasOwnProperty(c)&&(t[c]==null?delete r[c]:r[c]=t[c]);s="";for(let c in r)r.hasOwnProperty(c)&&(s!=""&&(s+="&"),s+=encodeURIComponent(c.replace(/%20/g,"+"))+"="+encodeURIComponent(r[c].replace(/%20/g,"+")));return s!=""?n+"?"+s:n}}function Ie(i){if(typeof window>"u"||!(window!=null&&window.open))throw new N(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,n=window.innerWidth,s=window.innerHeight;e=e>n?n:e,t=t>s?s:t;let r=n/2-e/2,o=s/2-t/2;return window.open(i,"popup_window","width="+e+",height="+t+",top="+o+",left="+r+",resizable,menubar=no")}class Ct extends ye{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,n){return n=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},n),this.client.send(this.baseCrudPath+"/import",n).then(()=>!0)}}class Ot extends G{async getList(e=1,t=30,n){return(n=Object.assign({method:"GET"},n)).query=Object.assign({page:e,perPage:t},n.query),this.client.send("/api/logs",n)}async getOne(e,t){if(!e)throw new N({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}}class _t extends G{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}}class kt extends G{getUrl(e,t,n={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";const s=[];s.push("api"),s.push("files"),s.push(encodeURIComponent(e.collectionId||e.collectionName)),s.push(encodeURIComponent(e.id)),s.push(encodeURIComponent(t));let r=this.client.buildUrl(s.join("/"));if(Object.keys(n).length){n.download===!1&&delete n.download;const o=new URLSearchParams(n);r+=(r.includes("?")?"&":"?")+o}return r}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}}class vt extends G{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}}class Pt{constructor(e="/",t,n="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=n,this.authStore=t||new bt,this.admins=new yt(this),this.collections=new Ct(this),this.files=new kt(this),this.logs=new Ot(this),this.settings=new gt(this),this.realtime=new Ge(this),this.health=new _t(this),this.backups=new vt(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new St(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let n in t){let s=t[n];switch(typeof s){case"boolean":case"number":s=""+s;break;case"string":s="'"+s.replace(/'/g,"\\'")+"'";break;default:s=s===null?"null":s instanceof Date?"'"+s.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(s).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+n+"}",s)}return e}getFileUrl(e,t,n={}){return this.files.getUrl(e,t,n)}buildUrl(e){var n;let t=this.baseUrl;return typeof window>"u"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(n=window.location.origin)!=null&&n.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let n=this.buildUrl(e);if(this.beforeSend){const s=Object.assign({},await this.beforeSend(n,t));s.url!==void 0||s.options!==void 0?(n=s.url||n,t=s.options||t):Object.keys(s).length&&(t=s,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){const s=this.serializeQueryParams(t.query);s&&(n+=(n.includes("?")?"&":"?")+s),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(n,t).then(async s=>{let r={};try{r=await s.json()}catch{}if(this.afterSend&&(r=await this.afterSend(s,r)),s.status>=400)throw new N({url:s.url,status:s.status,data:r});return r}).catch(s=>{throw new N(s)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),Me(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){const n=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(n);const s=new AbortController;this.cancelControllers[n]=s,t.signal=s.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData>"u"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;const t=new FormData;for(const n in e){const s=e[n];if(typeof s!="object"||this.hasBlobField({data:s})){const r=Array.isArray(s)?s:[s];for(let o of r)t.append(n,o)}else{let r={};r[n]=s,t.append("@jsonPayload",JSON.stringify(r))}}return t}hasBlobField(e){for(const t in e){const n=Array.isArray(e[t])?e[t]:[e[t]];for(const s of n)if(typeof Blob<"u"&&s instanceof Blob||typeof File<"u"&&s instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let n in e)if(n.toLowerCase()==t)return e[n];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData<"u"&&e instanceof FormData)}serializeQueryParams(e){const t=[];for(const n in e){if(e[n]===null)continue;const s=e[n],r=encodeURIComponent(n);if(Array.isArray(s))for(const o of s)t.push(r+"="+encodeURIComponent(o));else s instanceof Date?t.push(r+"="+encodeURIComponent(s.toISOString())):typeof s!==null&&typeof s=="object"?t.push(r+"="+encodeURIComponent(JSON.stringify(s))):t.push(r+"="+encodeURIComponent(s))}return t.join("&")}}const V=[];function Tt(i,e=L){let t;const n=new Set;function s(c){if(ae(i,c)&&(i=c,t)){const a=!V.length;for(const l of n)l[1](),V.push(l,i);if(a){for(let l=0;l<V.length;l+=2)V[l][0](V[l+1]);V.length=0}}}function r(c){s(c(i))}function o(c,a=L){const l=[c,a];return n.add(l),n.size===1&&(t=e(s,r)||L),c(i),()=>{n.delete(l),n.size===0&&t&&(t(),t=null)}}return{set:s,update:r,subscribe:o}}const x=new Pt("http://127.0.0.1:8090"),we=Tt(x.authStore.model);x.authStore.onChange(i=>{console.log("user changed: ",i),we.set(x.authStore.model)});function Re(i,e,t){const n=i.slice();return n[13]=e[t],n}function Ae(i,e){let t,n,s,r,o,c=e[13].name+"",a,l,f,u,p=e[13].url+"",m,g,k,b,h=e[13].clickTimes+"",S,y,O,U,P,_,E=e[13].id+"",j,w,v,D,Se,se,Ce,ce,Oe;function He(){return e[9](e[13])}function Je(){return e[10](e[13])}return{key:i,first:null,c(){t=C("div"),n=C("div"),s=C("p"),r=q("Name: "),o=C("span"),a=q(c),l=A(),f=C("p"),u=q("Link: "),m=q(p),g=A(),k=C("p"),b=q("Total click:"),S=q(h),y=A(),O=C("p"),U=q("Shorten: "),P=q(e[5]),_=q("/?id="),j=q(E),w=A(),v=C("div"),D=C("button"),D.textContent="Delete",Se=A(),se=C("button"),se.textContent="Copy",Ce=A(),T(o,"font-weight","bold"),T(n,"display","flex"),T(n,"column-gap","1rem"),T(t,"display","flex"),T(t,"flex-direction","column"),T(t,"row-gap",".3rem"),this.first=t},m(ee,H){R(ee,t,H),d(t,n),d(n,s),d(s,r),d(s,o),d(o,a),d(n,l),d(n,f),d(f,u),d(f,m),d(n,g),d(n,k),d(k,b),d(k,S),d(t,y),d(t,O),d(O,U),d(O,P),d(O,_),d(O,j),d(t,w),d(t,v),d(v,D),d(v,Se),d(v,se),d(t,Ce),ce||(Oe=[F(D,"click",He),F(se,"click",Je)],ce=!0)},p(ee,H){e=ee,H&1&&c!==(c=e[13].name+"")&&Q(a,c),H&1&&p!==(p=e[13].url+"")&&Q(m,p),H&1&&h!==(h=e[13].clickTimes+"")&&Q(S,h),H&1&&E!==(E=e[13].id+"")&&Q(j,E)},d(ee){ee&&I(t),ce=!1,K(Oe)}}}function Et(i){let e,t,n,s,r,o,c,a,l,f,u,p,m,g,k,b,h,S,y,O=[],U=new Map,P,_,E=Pe(i[0]);const j=w=>w[13].id;for(let w=0;w<E.length;w+=1){let v=Re(i,E,w),D=j(v);U.set(D,O[w]=Ae(D,v))}return{c(){e=C("h2"),e.textContent="Add url",t=A(),n=C("form"),s=C("div"),r=C("div"),o=C("p"),o.textContent="Url name",c=A(),a=C("input"),l=A(),f=C("div"),u=C("p"),u.textContent="Url",p=A(),m=C("input"),g=A(),k=C("button"),k.textContent="Add url",b=A(),h=C("h2"),h.textContent="Dashboard",S=A(),y=C("section");for(let w=0;w<O.length;w+=1)O[w].c();W(a,"type","text"),T(a,"width","100%"),T(a,"padding-block",".3rem"),a.required=!0,W(m,"type","url"),T(m,"width","100%"),T(m,"padding-block",".3rem"),m.required=!0,T(s,"display","flex"),T(s,"flex-direction","column"),T(s,"row-gap","1rem"),W(k,"type","submit"),T(k,"margin-top",".5rem"),T(k,"padding-block",".5rem"),T(n,"display","flex"),T(n,"flex-direction","column"),T(y,"display","flex"),T(y,"flex-direction","column"),T(y,"row-gap","1rem")},m(w,v){R(w,e,v),R(w,t,v),R(w,n,v),d(n,s),d(s,r),d(r,o),d(r,c),d(r,a),B(a,i[1]),d(s,l),d(s,f),d(f,u),d(f,p),d(f,m),B(m,i[2]),d(n,g),d(n,k),R(w,b,v),R(w,h,v),R(w,S,v),R(w,y,v);for(let D=0;D<O.length;D+=1)O[D]&&O[D].m(y,null);P||(_=[F(a,"input",i[7]),F(m,"input",i[8]),F(n,"submit",xe(i[3]))],P=!0)},p(w,[v]){v&2&&a.value!==w[1]&&B(a,w[1]),v&4&&m.value!==w[2]&&B(m,w[2]),v&113&&(E=Pe(w[0]),O=ct(O,v,j,1,w,E,U,y,at,Ae,null,Re))},i:L,o:L,d(w){w&&(I(e),I(t),I(n),I(b),I(h),I(S),I(y));for(let v=0;v<O.length;v+=1)O[v].d();P=!1,K(_)}}}function It(i,e,t){let n;Ue(i,we,b=>t(12,n=b));let s=[],r;De(async()=>{t(0,s=await x.collection("urls").getFullList({sort:"created"})),r=await x.collection("urls").subscribe("*",async({action:b,record:h})=>{if(b=="create"){const S=await x.collection("users").getOne(h.user);h.expand=S,t(0,s=[...s,h])}else b=="delete"&&t(0,s=s.filter(S=>S.id!=h.id))})}),Ze(()=>r());let o="",c="";async function a(){if(!n){alert("no login!, pls try again");return}const b={name:o,user:n.id,url:c,clickTimes:0};try{await x.collection("urls").create(b)}catch(h){alert(h)}}async function l(b){try{await x.collection("urls").delete(b)}catch(h){alert(`Cannot delete url:
, err:`+h)}}const f=window.location.origin;function u(b){const h=f+"/?id="+b;navigator.clipboard.writeText(h),alert("Copied the text: "+h)}function p(){o=this.value,t(1,o)}function m(){c=this.value,t(2,c)}return[s,o,c,a,l,f,u,p,m,b=>l(b.id??""),b=>u(b.id??"")]}class Rt extends ge{constructor(e){super(),be(this,e,It,Et,ae,{})}}function qe(i){let e,t;return{c(){e=C("p"),t=q(i[2]),T(e,"color","red")},m(n,s){R(n,e,s),d(e,t)},p(n,s){s&4&&Q(t,n[2])},d(n){n&&I(e)}}}function At(i){let e,t,n,s,r,o,c,a,l,f,u,p,m,g,k,b,h=i[2]!==""&&qe(i);return{c(){e=C("form"),t=C("label"),n=q(`username\r
        `),s=C("input"),r=A(),o=C("label"),c=q(`password\r
        `),a=C("input"),l=A(),f=C("button"),f.textContent="Register",u=A(),p=C("button"),p.textContent="Login",m=A(),h&&h.c(),g=$e(),W(s,"type","text"),W(s,"autocomplete","username"),W(a,"type","password"),W(a,"min","10"),W(a,"autocomplete","current-password")},m(S,y){R(S,e,y),d(e,t),d(t,n),d(t,s),B(s,i[0]),d(e,r),d(e,o),d(o,c),d(o,a),B(a,i[1]),d(e,l),d(e,f),d(e,u),d(e,p),R(S,m,y),h&&h.m(S,y),R(S,g,y),k||(b=[F(s,"input",i[6]),F(a,"input",i[7]),F(f,"click",i[4]),F(p,"click",i[3]),F(e,"submit",xe(i[5]))],k=!0)},p(S,[y]){y&1&&s.value!==S[0]&&B(s,S[0]),y&2&&a.value!==S[1]&&B(a,S[1]),S[2]!==""?h?h.p(S,y):(h=qe(S),h.c(),h.m(g.parentNode,g)):h&&(h.d(1),h=null)},i:L,o:L,d(S){S&&(I(e),I(m),I(g)),h&&h.d(S),k=!1,K(b)}}}function qt(i,e,t){let n="",s="",r="";async function o(){try{await x.collection("users").authWithPassword(n,s)}catch(u){t(2,r="cannot login! please check your username, password"),alert(`cannot login
err: `+u)}}async function c(){const u={username:n,password:s,passwordConfirm:s};try{await x.collection("users").create(u),await o()}catch(p){t(2,r="Cannot register, please try again"),alert(`cannot login, 
err: `+p)}}function a(u){et.call(this,i,u)}function l(){n=this.value,t(0,n)}function f(){s=this.value,t(1,s)}return[n,s,r,o,c,a,l,f]}class jt extends ge{constructor(e){super(),be(this,e,qt,At,ae,{})}}function Lt(i){let e,t=i[1].username+"",n,s,r,o,c,a,l,f;return c=new Rt({}),{c(){e=q("Login as "),n=q(t),s=A(),r=C("button"),r.textContent="Logout",o=A(),Ke(c.$$.fragment)},m(u,p){R(u,e,p),R(u,n,p),R(u,s,p),R(u,r,p),R(u,o,p),pe(c,u,p),a=!0,l||(f=F(r,"click",i[2]),l=!0)},p(u,p){(!a||p&2)&&t!==(t=u[1].username+"")&&Q(n,t)},i(u){a||(Z(c.$$.fragment,u),a=!0)},o(u){oe(c.$$.fragment,u),a=!1},d(u){u&&(I(e),I(n),I(s),I(r),I(o)),me(c,u),l=!1,f()}}}function Ut(i){let e,t;return e=new jt({}),{c(){Ke(e.$$.fragment)},m(n,s){pe(e,n,s),t=!0},p:L,i(n){t||(Z(e.$$.fragment,n),t=!0)},o(n){oe(e.$$.fragment,n),t=!1},d(n){me(e,n)}}}function $t(i){let e;return{c(){e=q("Redirecting...")},m(t,n){R(t,e,n)},p:L,i:L,o:L,d(t){t&&I(e)}}}function xt(i){let e,t,n,s;const r=[$t,Ut,Lt],o=[];function c(a,l){return a[0]?0:a[1]?2:1}return e=c(i),t=o[e]=r[e](i),{c(){t.c(),n=$e()},m(a,l){o[e].m(a,l),R(a,n,l),s=!0},p(a,[l]){let f=e;e=c(a),e===f?o[e].p(a,l):(rt(),oe(o[f],1,1,()=>{o[f]=null}),ot(),t=o[e],t?t.p(a,l):(t=o[e]=r[e](a),t.c()),Z(t,1),t.m(n.parentNode,n))},i(a){s||(Z(t),s=!0)},o(a){oe(t),s=!1},d(a){a&&I(n),o[e].d(a)}}}function Nt(i,e,t){let n;Ue(i,we,o=>t(1,n=o));async function s(){x.authStore.clear()}let r=!1;return De(async()=>{const o=window.location.search;if(o){const a=new URLSearchParams(o).get("id");if(!a)return;t(0,r=!0);try{const l=await x.collection("urls").getOne(a),f=l.clickTimes+1,u={...l,clickTimes:f};await x.collection("urls").update(a,u),window.location.replace(l.url)}catch(l){alert(`Url was not found, you sure about your url?
 err: `+l)}}}),[r,n,s]}class Dt extends ge{constructor(e){super(),be(this,e,Nt,xt,ae,{})}}new Dt({target:document.getElementById("app")});
